<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSIF Informa</title>
  <style>
    /* --- Tus estilos se mantienen igual --- */
    /* Los omito aqu√≠ para no alargar, pero no cambian */
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo">CSIF Noticias</div>
    <div class="header-right">
      <img src="csif.png" alt="Logo CSIF" class="csif-logo">
      <button class="admin-btn" id="adminBtn">‚öô Administrar</button>
      <div class="user-info" id="userInfo">
        <span id="userName">Usuario</span>
        <button class="logout-btn" id="logoutBtn">Cerrar Sesi√≥n</button>
      </div>
      <button class="user-btn" id="userBtn">üë§ Iniciar Sesi√≥n</button>
    </div>
  </header>

  <!-- Modal de Login -->
  <div class="modal" id="loginModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Iniciar Sesi√≥n</h2>
      </div>
      <form id="loginForm">
        <div class="form-group">
          <label for="username">Introduce tu usuario:</label>
          <input type="text" id="username" name="fname" required>
        </div>
        <button type="submit" class="login-btn">Acceder</button>
      </form>
      <div id="loginMessage" style="margin-top:10px; color:red; display:none;"></div>
    </div>
  </div>

  <!-- Contenido bloqueado -->
  <div id="appContent" class="locked">
    <!-- Navegaci√≥n din√°mica -->
    <nav class="main-nav">
      <div class="nav-container" id="nav-container">
        <!-- üö® AQU√ç se insertar√°n las categor√≠as desde la base de datos -->
      </div>
    </nav>

    <!-- üö® Subnavegaci√≥n din√°mica -->
    <div id="subnav-container-wrapper">
      <!-- Aqu√≠ se crear√°n los subnav seg√∫n la categor√≠a seleccionada -->
    </div>

    <main>
      <h2 class="section-title" id="current-category">Todas las Noticias</h2>
      <div class="news-grid" id="news-container"></div>
    </main>

    <footer>
      <div class="footer-links">
        <a href="#" class="footer-link">Inicio</a>
        <a href="#" class="footer-link">Qui√©nes Somos</a>
        <a href="#" class="footer-link">Afiliaci√≥n</a>
        <a href="#" class="footer-link">Contacto</a>
        <a href="#" class="footer-link">Aviso Legal</a>
      </div>
      <div>&copy; 2025 CSIF - Todos los derechos reservados.</div>
    </footer>
  </div>

  <div class="floating-btn">‚Üë</div>

  <script>
    // ================================
    // üîπ Usuarios de ejemplo
    // ================================
    const users = [
      { username:"10000000A", name:"Administrador CSIF", role:"admin" },
      { username:"00000001A", name:"Mar√≠a L√≥pez", role:"Afiliado" },
      { username:"00000002A", name:"Carlos Rodr√≠guez", role:"Afiliado" }
    ];

    // ================================
    // üîπ EJEMPLO DE CATEGOR√çAS en JSON
    // üö® Esto luego vendr√° de tu NoSQL
    // ================================
    /*
    Estructura recomendada en tu base de datos NoSQL:
    {
      "categorias": [
        {
          "nombre": "ENFERMERIA",
          "subcategorias": ["plantillas", "turnos", "formacion"]
        },
        {
          "nombre": "TCAE",
          "subcategorias": ["plantillas", "turnos", "convenio"]
        }
      ]
    }
    */
    let categoriasData = []; // üö® Aqu√≠ cargar√°s desde tu NoSQL

    // ================================
    // üîπ Noticias de ejemplo
    // üö® En un futuro tambi√©n deber√≠an venir de la base de datos
    // ================================
    let newsData = { todas:[
      {id:1,category:"ENFERMERIA",subcategory:"plantillas",title:"CSIF logra aumento de plantilla",excerpt:"Contrataci√≥n de 200 nuevos profesionales",image:"https://via.placeholder.com/400x200?text=Enfermer√≠a",date:"Hace 2h"},
      {id:2,category:"TCAE",subcategory:"turnos",title:"Mejoras en los turnos TCAE",excerpt:"Negociaci√≥n de rotaci√≥n de turnos",image:"https://via.placeholder.com/400x200?text=TCAE",date:"Hace 5h"}
    ]};

    document.addEventListener("DOMContentLoaded",()=>{
      const userBtn=document.getElementById("userBtn"),
            loginModal=document.getElementById("loginModal"),
            loginForm=document.getElementById("loginForm"),
            userInfo=document.getElementById("userInfo"),
            userName=document.getElementById("userName"),
            logoutBtn=document.getElementById("logoutBtn"),
            loginMessage=document.getElementById("loginMessage"),
            adminBtn=document.getElementById("adminBtn"),
            newsContainer=document.getElementById("news-container"),
            appContent=document.getElementById("appContent"),
            currentCategoryTitle=document.getElementById("current-category"),
            navContainer=document.getElementById("nav-container"),
            subnavWrapper=document.getElementById("subnav-container-wrapper");

      // ================================
      // üîπ FUNCI√ìN PARA CARGAR CATEGOR√çAS DESDE NoSQL
      // ================================
      async function loadCategories(){
        // üö® Aqu√≠ conectas con tu base de datos NoSQL
        // Ejemplo si usas Firebase Firestore:
        /*
        const querySnapshot = await getDocs(collection(db, "categorias"));
        categoriasData = querySnapshot.docs.map(doc => doc.data());
        */
        
        // üö® Por ahora simulamos con datos "mock":
        categoriasData = [
          { nombre:"ENFERMERIA", subcategorias:["plantillas","turnos","formacion"] },
          { nombre:"TCAE", subcategorias:["plantillas","turnos","convenio"] },
          { nombre:"CELADOR", subcategorias:["plantillas","formacion"] }
        ];

        renderCategories();
      }

      // ================================
      // üîπ Renderizar categor√≠as din√°micamente
      // ================================
      function renderCategories(){
        navContainer.innerHTML="";
        
        // Bot√≥n "Todas"
        const allBtn = document.createElement("div");
        allBtn.className="nav-item active";
        allBtn.dataset.category="todas";
        allBtn.textContent="Todas";
        navContainer.appendChild(allBtn);

        // Insertar categor√≠as desde NoSQL
        categoriasData.forEach(cat=>{
          const item=document.createElement("div");
          item.className="nav-item";
          item.dataset.category=cat.nombre;
          item.textContent=cat.nombre;
          navContainer.appendChild(item);

          // Crear su subnav
          const subnav=document.createElement("div");
          subnav.className="sub-nav";
          subnav.id="subnav-"+cat.nombre;
          const subContainer=document.createElement("div");
          subContainer.className="sub-nav-container";
          cat.subcategorias.forEach((sub,i)=>{
            const subItem=document.createElement("div");
            subItem.className="sub-nav-item"+(i===0?" active":"");
            subItem.dataset.subcategory=sub;
            subItem.textContent=sub;
            subContainer.appendChild(subItem);
          });
          subnav.appendChild(subContainer);
          subnavWrapper.appendChild(subnav);
        });

        initNavigation();
      }

      // ================================
      // üîπ Inicializar navegaci√≥n (event listeners)
      // ================================
      function initNavigation(){
        document.querySelectorAll(".nav-item").forEach(it=>{
          it.onclick=()=>{
            document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));
            it.classList.add("active");

            document.querySelectorAll(".sub-nav").forEach(s=>s.classList.remove("active"));
            const cat=it.dataset.category;
            const subnav=document.getElementById("subnav-"+cat);
            if(subnav) subnav.classList.add("active");

            displayNews(cat);
          };
        });

        document.querySelectorAll(".sub-nav-item").forEach(it=>{
          it.onclick=()=>{
            const parent = it.closest(".sub-nav");
            parent.querySelectorAll(".sub-nav-item").forEach(i=>i.classList.remove("active"));
            it.classList.add("active");
            const cat = parent.id.replace("subnav-","");
            const subcat = it.dataset.subcategory;
            displayNews(cat,subcat);
          };
        });
      }

      // ================================
      // üîπ Mostrar noticias
      // ================================
      function displayNews(cat="todas", subcat=null){
        newsContainer.innerHTML="";
        let data = newsData[cat] || [];
        if(subcat){ data = data.filter(n=>n.subcategory===subcat); }
        data.forEach(n=>{
          const c=document.createElement("div"); c.className="news-card";
          c.innerHTML=`<img src="${n.image}" loading="lazy"><div class="news-content">
          <span class="news-category">${n.category}</span>
          <h3 class="news-title">${n.title}</h3><p class="news-excerpt">${n.excerpt}</p>
          <div class="news-meta"><span>${n.date}</span><span>CSIF</span></div></div>`;
          newsContainer.appendChild(c);
        });
        currentCategoryTitle.textContent = (cat==="todas") ? "Todas las Noticias" : cat;
      }

      // ================================
      // üîπ Autenticaci√≥n b√°sica (igual que antes)
      // ================================
      loginForm.onsubmit=e=>{
        e.preventDefault();
        const username=document.getElementById("username").value.trim();
        const u=users.find(us=>us.username===username);
        if(u){
          localStorage.setItem("currentUser",JSON.stringify(u));
          updateUI(u); unlockApp(); displayNews();
        } else {
          loginMessage.textContent="Usuario no v√°lido"; loginMessage.style.display="block";
        }
      };
      logoutBtn.onclick=()=>{ localStorage.removeItem("currentUser"); updateUI(); lockApp(); };

      function lockApp(){ appContent.classList.add("locked"); loginModal.style.display="flex"; }
      function unlockApp(){ appContent.classList.remove("locked"); loginModal.style.display="none"; }
      function updateUI(u){ if(u){ userBtn.style.display="none"; userInfo.style.display="flex"; userName.textContent=u.name; if(u.role==="admin") adminBtn.style.display="flex"; } else { userBtn.style.display="flex"; userInfo.style.display="none"; adminBtn.style.display="none"; } }

      // ================================
      // üîπ Inicializaci√≥n
      // ================================
      const cu=localStorage.getItem("currentUser");
      if(cu){ updateUI(JSON.parse(cu)); unlockApp(); displayNews(); } else { lockApp(); }

      loadCategories(); // üö® Cargamos categor√≠as desde NoSQL
    });
  </script>
</body>
</html>
